library(shiny)
library(leaflet)
library(sf)
library(bslib)
library(rnaturalearth)
library(ggplot2)
library(shinyWidgets)
library(shinydashboard)
library(dplyr)
library(plotly)

kenya_shapefile <- st_read("C:/Users/anitt/Downloads/ken_adm_iebc_20191031_shp (1)/ken_admbnda_adm1_iebc_20191031.shp")

province_shapefile <- st_read("C:/Users/anitt/Desktop/output/KEN_adm1.shp")

sub_county_shapefile <- st_read("C:\\Users\\anitt\\Downloads\\ke_subcounty\\ke_subcounty.shp")

province_names <- c(
  "Central", "Coast", "Eastern", 
  "Nairobi", "North Eastern", "Nyanza", 
  "Rift Valley", "Western"
)

province_shapefile$Province_Name <- province_names[province_shapefile$FID + 1]

province_screening_data <- data.frame( 
  Province = province_names,
  Province_Breast_screening_Rate = c(22.34, 10.49, 19.34, 23.38, 5.90, 13.09, 15.36, 16.80),
  Province_Breast_lower_CI = c(19.54, 8.49, 15.23, 17.24, 1.9, 10.5, 13.63, 12.83),
  Province_Breast_upper_CI = c(25.14, 12.49, 23.45, 29.52, 9.9, 15.68, 17.09, 20.77),
  Province_Cervical_screening_Rate = c(22.19, 9.64, 14.57, 30.18, 4.11, 19.53, 22.14, 14.3),
  Province_Cervical_lower_CI = c(19.32, 7.94, 12.25, 23.39, 0.59, 17.68, 19.47, 11.86),
  Province_Cervical_upper_CI = c(25.06, 11.35, 16.88, 36.97, 7.63, 21.38, 24.81, 16.74)
)

county_names <- c( "Baringo", "Bomet", "Bungoma", "Busia", "Elgeyo-Marakwet", "Embu", "Garissa", "Homa Bay", "Isiolo", "Kajiado",
                   "Kakamega", "Kericho", "Kiambu", "Kilifi", "Kirinyaga", "Kisii", "Kisumu", "Kitui", "Kwale", "Laikipia",
                   "Lamu", "Machakos", "Makueni", "Mandera", "Marsabit", "Meru", "Migori", "Mombasa", "Murang'a", "Nairobi",
                   "Nakuru", "Nandi", "Narok", "Nyamira", "Nyandarua", "Nyeri", "Samburu", "Siaya", "Taita Taveta", "Tana River",
                   "Tharaka-Nithi", "Trans Nzoia", "Turkana", "Uasin Gishu", "Vihiga", "Wajir", "West Pokot"
)

# 
# kenya_shapefile$ADM1_EN <- county_names[kenya_shapefile$]

county_screening_data <- data.frame(
  County = county_names,
  Breast_screening_Rate = c(17.96, 12.22, 15.46, 18.63, 12.32, 25.56, 1.76, 8.4, 49.28, 29.39,
                            16.13, 22.67, 42.83, 13.51, 26.07, 25.39, 9.66, 9.05, 9.85, 57.96,
                            12.88, 42.62, 15.27, 2.13, 25.53, 43.12, 17.9, 28.81, 39.27, 36.71,
                            37.75, 14.18, 15.99, 6.09, 39.98, 48.13, 11.67, 3.26, 28.69, 10,
                            38.3, 17.05, 1.36, 39.91, 7.24, 2.85, 16.04),
  Breast_lower_CI = c(11.8, 7.34, 11.8, 13.8, 6.63, 16.63, -0.01, 5.33, 42.92, 22.88,
                      12.34, 15.98, 36.28, 10.15, 20.64, 20.17, 5.2, 5.07, 5.06, 51.45,
                      7.37, 36.38, 11.18, -0.55, 17.13, 36.14, 13.81, 22.12, 33.67, 31.48,
                      30.66, 9.61, 8.36, 2.9, 31.57, 40.85, 7.48, 1.01, 18.67, 4.12,
                      32.12, 13.55, 0, 34.77, 3.83, 0.24, 10.53),
  Breast_upper_CI = c(24.13, 17.09, 19.12, 23.46, 18.01, 34.49, 3.54, 11.47, 55.65, 35.91,
                      19.92, 29.36, 49.38, 16.86, 31.5, 30.62, 14.12, 13.03, 14.65, 64.47,
                      18.38, 48.86, 19.36, 4.8, 33.93, 50.1, 22, 35.5, 44.87, 41.93,
                      44.84, 18.75, 23.62, 9.27, 48.4, 55.41, 15.87, 5.52, 38.7, 15.87,
                      44.47, 20.54, 2.72, 45.05, 10.66, 5.45, 21.55),
  Cervical_screening_Rate = c(78.37, 71.68, 76.85, 66.47, 86.64, 81.48, 5.21, 88.75, 76.56, 75.38,
                              61.39, 79.13, 86.57, 43.76, 89.4, 79.8, 88.08, 64.6, 68.05, 73.84,
                              64.95, 84.84, 81.89, 3.77, 32.22, 87.77, 81.47, 83.17, 84.77, 89.51,
                              81.24, 69.61, 66.91, 83.1, 87.09, 87.68, 47.48, 85.53, 89.97, 54.03,
                              87.1, 64.51, 8.73, 93.04, 64.04, 5.78, 19.74),
  Cervical_lower_CI = c(72.48, 65.64, 68.56, 61.55, 82.27, 73.28, 1.32, 84.19, 67.05, 68.07,
                        55.59, 75.77, 82.33, 38.46, 85.68, 74.61, 84.22, 55.82, 61.69, 63.52,
                        57.49, 79.89, 75.27, 1.24, 22.92, 82.22, 76.6, 77.43, 80.17, 86.7,
                        76.12, 65.35, 61.53, 79.08, 83.09, 84.09, 37.32, 80.09, 85.1, 45.39,
                        81.77, 55.98, 3.24, 89.27, 55.69, 0.66, 12.04),
  Cervical_upper_CI = c(84.25, 77.71, 85.13, 71.38, 91.01, 89.68, 9.1, 93.3, 86.07, 82.68,
                        67.19, 82.49, 90.8, 49.07, 93.12, 84.98, 91.94, 73.38, 74.4, 84.16,
                        72.41, 89.78, 88.5, 6.31, 41.52, 93.33, 86.33, 88.9, 89.37, 92.33,
                        86.35, 73.87, 72.28, 87.12, 91.08, 91.28, 57.63, 90.96, 94.84, 62.67,
                        92.42, 73.04, 14.22, 96.8, 72.39, 10.9, 27.43)
)

kenya_shapefile <- left_join(kenya_shapefile, county_screening_data, by = c("ADM1_EN" = "County"))

subcounty_names <- c(
  "Ainabkoi Sub County", 
  "Ainamoi Sub County", 
  "Aldai Sub County",
  "Alego Usonga Sub County",
  "Athi River Sub County",
  "Awendo Sub County",
  "Balambala Sub County",
  "BANISSA",
  "Baringo Central Sub County",
  "Baringo North Sub County",
  "Belgut Sub County",
  "Bobasi Sub County",
  "Bomachoge Borabu Sub County",
  "Bomachoge Chache Sub County",
  "Bomet Central Sub County",
  "Bomet East Sub County",
  "Bonchari  Sub County",
  "Bondo Sub County",
  "Borabu Sub County",
  "Bumula Sub County",
  "Bunyala Sub County",
  "Bura Sub County",
  "Bureti Sub County",
  "Butere Sub County",
  "Butula Sub County",
  "Buuri Sub County",
  "Changemwe Sub County",
  "Chepalungu Sub County",
  "Cheptais Sub County",
  "Cherangany Sub County",
  "Chesumei Sub County",
  "Chuka Sub County",
  "Dadaab Sub County",
  "Dagoretti North Sub County",
  "Dagoretti South Sub County",
  "East Pokot Sub County",
  "Eldas Sub County",
  "Embakasi Central Sub County",
  "Embakasi East Sub County",
  "Embakasi North Sub County",
  "Embakasi South Sub County",
  "Embakasi West Sub County",
  "Emgwen Sub County",
  "Emuhaya Sub County",
  "Endebess Sub County",
  "Fafi Sub County",
  "Galole Sub County",
  "Ganze Sub County",
  "Garbatulla Sub County",
  "Garissa Sub County",
  "Garsen Sub County",
  "Gatanga Sub County",
  "Gatundu North Sub County",
  "Gatundu South Sub County",
  "Gem Sub County",
  "Gilgil Sub County",
  "Githunguri Sub County",
  "Hamisi Sub County",
  "Homa Bay Town Sub County",
  "Hulugho Sub County",
  "Igambang'ombe Sub County",
  "Igembe Central Sub County",
  "Igembe North Sub County",
  "Igembe South Sub County",
  "Ijara Sub County",
  "Ikolomani Sub County",
  "Imenti Central Sub County",
  "Imenti North Sub County",
  "Imenti South Sub County",
  "Isiolo Sub County",
  "Jomvu Sub County",
  "Juja Sub County",
  "Kabete Sub County",
  "Kabondo Kasipul Sub County",
  "Kabuchai Sub County",
  "Kaiti  Sub County",
  "Kajiado Central Sub County",
  "Kajiado East Sub County",
  "Kajiado North Sub County",
  "Kajiado West Sub County",
  "Kalama Sub County",
  "Kaloleni Sub County",
  "Kamukunji  Sub County",
  "Kandara Sub County",
  "Kanduyi Sub County",
  "Kangema Sub County",
  "Kangundo Sub County",
  "Kapseret Sub County",
  "Karachuonyo Sub County",
  "Kasarani  Sub County",
  "Kasipul Sub County",
  "Kathiani Sub County",
  "Keiyo North Sub County",
  "Keiyo South Sub County",
  "Kesses Sub County",
  "Khwisero Sub County",
  "Kiambaa Sub County",
  "Kiambu Town Sub County",
  "Kibish Sub County",
  "Kibra  Sub County",
  "Kibwezi East  Sub County",
  "Kibwezi West  Sub County",
  "Kieni East Sub County",
  "Kieni West Sub County",
  "Kigumo Sub County",
  "Kiharu Sub County",
  "Kikuyu Sub County",
  "Kilifi North Sub County",
  "Kilifi South Sub County",
  "Kilome Sub County",
  "Kimilili Sub County",
  "Kiminini  Sub County",
  "Kinango Sub County",
  "Kinangop Sub County",
  "Kipipiri Sub County",
  "Kipkelion East Sub County",
  "Kipkelion West Sub County",
  "Kirinyaga Central Sub County",
  "Kirinyaga East Sub County",
  "Kirinyaga North/Mwea West Sub County",
  "Kirinyaga South Sub County",
  "Kirinyaga West Sub County",
  "Kisauni Sub County",
  "Kisumu Central Sub County",
  "Kisumu East Sub County",
  "Kisumu West Sub County",
  "Kitui Central  Sub County",
  "Kitui East Sub County",
  "Kitui Rural Sub County",
  "Kitui South Sub County",
  "Kitui West  Sub County",
  "Kitutu Chache North Sub County",
  "Kitutu Chache South Sub County",
  "Koibatek Sub County",
  "Konoin Sub County",
  "Kuresoi North  Sub County",
  "Kuresoi South  Sub County",
  "Kuria East Sub County",
  "Kuria West Sub County",
  "Kutulo Sub County",
  "Kwanza  Sub County",
  "LAFEY",
  "Lagdera Sub County",
  "Laikipia East Sub County",
  "Laikipia North Sub County",
  "Laikipia West Sub County",
  "LAISAMIS",
  "LAMU EAST",
  "LAMU WEST",
  "Langata  Sub County",
  "Lari Sub County",
  "Likoni Sub County",
  "Likuyani Sub County",
  "Limuru Sub County",
  "Loima Sub County",
  "Loitokitok Sub County",
  "Luanda Sub County",
  "Lugari Sub County",
  "Lunga Lunga Sub County",
  "Lurambi Sub County",
  "Machakos Sub County",
  "Magarini Sub County",
  "Makadara  Sub County",
  "Makueni  Sub County",
  "Malava Sub County",
  "Malindi Sub County",
  "MANDERA EAST",
  "MANDERA NORTH",
  "MANDERA SOUTH",
  "MANDERA WEST",
  "Manga Sub County",
  "Manyatta  Sub County",
  "Marakwet East sub-county",
  "Marakwet West Sub County",
  "Marigat Sub County",
  "Masaba North Sub County",
  "Masinga Sub County",
  "Matayos Sub County",
  "Mathare  Sub County",
  "Mathioya Sub County",
  "Mathira East Sub County",
  "Mathira West Sub County",
  "Matuga Sub County",
  "Matungu Sub County",
  "Matungulu Sub County",
  "Mbeere North  Sub County",
  "Mbeere South  Sub County",
  "Mbita Sub County",
  "Mbooni  Sub County",
  "Merti Sub County",
  "Mogotio Sub County",
  "Moiben Sub County",
  "Molo  Sub County",
  "Mosop Sub County",
  "MOYALE",
  "Msambweni Sub County",
  "Mt Elgon Sub County",
  "Muhoroni Sub County",
  "Mukurweini Sub County",
  "Mumias East Sub County",
  "Mumias West  Sub County",
  "Muranga South Sub County",
  "Muthambi Sub County",
  "Mvita Sub County",
  "Mwala Sub County",
  "Mwatate Sub County",
  "Mwimbi Sub County",
  "Mwingi Central Sub- County",
  "Mwingi North Sub County",
  "Mwingi West Sub County",
  "Naivasha  Sub County",
  "Nakuru East  Sub County",
  "Nakuru North  Sub County",
  "Nakuru West  Sub County",
  "Nambale Sub County",
  "Nandi East Sub County",
  "Narok East Sub County",
  "Narok North Sub County",
  "Narok South Sub County",
  "Narok West Sub County",
  "Navakholo Sub County",
  "Ndaragwa Sub County",
  "Ndhiwa Sub County",
  "Njoro  Sub County",
  "NORTH HORR",
  "Nyakach Sub County",
  "Nyali Sub County",
  "Nyamira North Sub County",
  "Nyamira Sub County",
  "Nyando Sub County",
  "Nyaribari Chache  Sub County",
  "Nyaribari Masaba Sub County",
  "Nyatike Sub County",
  "Nyeri Central Sub County",
  "Nyeri South Sub County",
  "Oljoroorok Sub County",
  "Olkalou Sub County",
  "Pokot Central Sub County",
  "Pokot North Sub County",
  "Pokot South Sub County",
  "Rabai Sub County",
  "Rangwe Sub County",
  "Rarieda Sub County",
  "Rongai  Sub County",
  "Rongo Sub County",
  "Roysambu  Sub County",
  "Ruaraka  Sub County",
  "Ruiru Sub County",
  "Runyenjes  Sub County",
  "Sabatia Sub County",
  "Saboti  Sub County",
  "SAKU",
  "Samburu Central Sub County",
  "Samburu East Sub County",
  "Samburu North Sub County",
  "Samia Sub County",
  "Seme Sub County",
  "Shinyalu Sub County",
  "Sigowet/Soin Sub County",
  "Sirisia Sub County",
  "Sotik Sub County",
  "South Mugirango Sub County",
  "Soy Sub County",
  "Starehe  Sub County",
  "Suba Sub County",
  "Subukia  Sub County",
  "Suna East Sub County",
  "Suna West Sub County",
  "Tarbaj Sub County",
  "Taveta Sub County",
  "Teso North Sub County",
  "Teso South Sub County",
  "Tetu Sub County",
  "Tharaka North Sub County",
  "Tharaka South Sub County",
  "Thika Town Sub County",
  "Tiaty Sub County",
  "Tigania East Sub County",
  "Tigania West Sub County",
  "Tinderet Sub County",
  "Tongaren Sub County",
  "Transmara East Sub County",
  "Transmara West Sub County",
  "Turbo Sub County",
  "Turkana Central Sub County",
  "Turkana East Sub County",
  "Turkana North Sub County",
  "Turkana South Sub County",
  "Turkana West Sub County",
  "Ugenya Sub County",
  "Ugunja Sub County",
  "Uriri Sub County",
  "Vihiga Sub County",
  "Voi Sub County",
  "Wajir East Sub County",
  "Wajir North Sub County",
  "Wajir South Sub County",
  "Wajir West Sub County",
  "Webuye  East Sub County",
  "Webuye West Sub County",
  "West Pokot Sub County",
  "Westlands  Sub County",
  "Wundanyi Sub County",
  "Yatta Sub County"
)

subcounty_screening_data <- data.frame(
  Subcounty = subcounty_names,
  Breast_screening_Rate = c(31.47030414,24.61399714,0.5,22.74572559,35.12880111,15.5188019,5.170691448,6.063589587,12.24919123,17.40215168,4.627830294,10.20699199,38.60501432,0,0.5,22.66399526,8.927935457,12.84899339,11.6127618,7.272180261,33.60290015,0,12.56003132,33.85430563,0.5,6.839115933,37.26941216,19.9249808,25,21.6791709,3.223677024,47.52562993,21.42034641,23.92043106,21.12061462,4.131531344,7.698982633,13.24359965,9.789800226,23.51905922,21.57593585,13.39130521,0.5,11.98091768,14.23290276,18.38065718,42.47627765,5.906425405,10.00877423,10.27020716,31.57890807,15.78407928,29.90550407,24.18604383,0.5,0.5,15.02424518,0,22.13276635,0.5,0.5,35.24595067,23.39943337,10.37844471,13.77177372,14.13151371,31.27908748,0.5,8.743712782,9.631581269,14.15234112,37.87045144,19.19548318,14.31129393,9.004472205,32.87620257,26.69555108,19.23081786,0,12.78027742,34.01463126,10.00426522,9.332200642,0.5,28.0681772,24.13190407,29.3076109,35.97927254,17.69772363,36.39974385,8.439414198,0,0.5,44.87361977,3.499861484,30.61777543,12.08373496,31.92652662,26.56350498,27.52554532,17.20741503,28.03378443,30.97492098,25.63110603,6.783134203,13.87826563,0.5,10.98442637,18.07578304,25.35340944,13.81251854,14.86989942,0.5,25.55563572,0.5,21.367274,19.70380678,21.62239725,9.876015898,17.82445927,7.110892974,0.5,20.19194608,0.5,24.27850912,34.37585475,18.09044581,0.5,10.00299799,16.55223734,0,0.5,0.5,5.013218501,8.849206058,18.17397606,3.554509262,8.826336173,0.5,20.75797871,12.23016181,33.80932567,27.45055741,49.19441988,41.72387015,32.45437686,11.78181419,43.86781083,0.5,9.234451438,19.68634453,16.69590974,12.81023977,11.59352583,0.5,8.002110734,0.5,0.5,0,9.469103195,24.2039048,0.5,4.905488706,10.296615,30.13950115,20.7594224,5.841774303,8.163494305,60,0.5,3.099423158,11.78411596,23.23080359,46.31729993,10.50949563,25.12914914,20.75956568,8.955244904,14.07103173,5.586001073,29.81333045,39.6226907,13.14960337,4.160633343,8.813585074,9.083624165,12.62054763,0.5,14.10849304,0.5,32.48774171,0.5,24.31136361,34.24790322,8.059163661,0,22.01290269,24.04574101,0.5,0.5,19.85289777,42.71615768,22.39158721,0.5,0.5,5.459258126,7.459201112,41.23194719,30.33172269,9.503066034,20.89798852,2.450766926,21.7166056,1.560747883,7.872352441,5.619875056,10.65233607,19.98065668,28.72486759,3.460692111,0.5,10.32908566,19.37410759,4.796063216,10.16657234,27.82796969,17.29603116,4.048468511,10.32909613,5.40678441,6.793287124,22.09718197,5.390065985,10.25941651,14.44178002,44.82748859,19.46544366,19.12994631,17.19328755,3.024986295,13.32962396,0.5,29.37964529,33.05221273,14.7826704,7.543424822,7.619851778,26.13039871,10.84063546,25.4163299,14.15845663,6.086532309,12.64634958,6.537239622,7.507129557,10.83664465,23.19350654,24.89969406,0,0,19.72045253,6.299276505,29.50856519,14.75391421,15.14869132,29.13828914,13.01255207,13.75882424,0,37.54294259,22.27589741,0.5,6.40464774,8.217826583,45.22515097,21.41077272,22.02418298,25.91670967,19.54052531,19.33087229,21.17864975,10.09004742,3.386633183,0.5,17.30457278,11.92407861,0,8.974471697,8.315271452,11.00455636,35.78066316,0,34.82414547,0.5,17.95149111,56.66759012,0.5,12.95577641,18.94281362,0.5,39.23331152,0.5,0,7.240876537),
  Breast_lower_CI = c(20.42649759,13.12911958,0.5,6.780953199,32.58750672,7.950693907,1.891921868,1.522350148,2.237520324,5.964655442,1.566791225,3.67210706,10.2626776,0,0.5,13.59016085,3.991978926,4.123941292,5.099276866,1.748281974,15.49242597,0,6.982507672,10.45695991,0.5,1.721915616,28.05433357,10.00828264,25,5.361334299,0.657761624,42.74900634,11.86665554,10.08676785,16.02532933,1.172816114,2.194546094,2.896992615,2.461147457,16.11226378,14.17322112,6.578977771,0.5,5.127693468,3.178515393,16.15121597,30.56321826,1.632489798,2.591129606,0.914001483,26.01954342,10.73193992,8.127204479,15.2117499,0.5,0.5,8.253532639,0,0.5,4.415871276,0.5,0.5,26.41105185,6.012355262,2.731514392,4.152449939,5.410681411,16.81323042,0.5,2.321009571,2.60660376,6.988079512,18.70104947,9.647764036,3.067827652,4.574142572,20.23223125,5.10544795,9.052488108,0,4.497909749,11.70091056,2.788580586,2.466818617,0.5,15.60098116,4.781984186,16.46842763,16.80471974,9.674905459,23.85811266,2.102590235,0,0.5,32.7068879,0.740608402,16.8854368,4.52327831,21.24585509,5.845277125,5.062866366,6.277530312,14.91632908,17.42888196,18.4553251,1.581807949,3.198881284,0.5,2.545958678,10.38484393,18.82643775,7.653030051,8.978194777,0.5,12.41913561,0.5,5.489130443,8.501204149,6.032203053,2.669089935,5.793373174,1.655858597,0.5,9.695069501,0.5,17.25391542,20.82339196,9.901469009,0.5,3.466366703,8.833623091,0,0.5,0.5,1.149600779,3.132177466,4.222188875,0.744755666,4.88280994,0.5,11.91521268,5.558881256,14.81428775,14.0158021,38.00117069,28.8494456,10.12449384,6.689471141,29.54082521,0.5,3.409705355,4.185988174,9.020201957,3.586523739,2.865602914,0.5,3.343365822,0.5,0.5,0,4.408813926,11.3379445,0.5,1.573464305,2.730802173,15.00524255,6.702205465,1.401443355,2.052460756,60,0.5,0.655664416,4.136326979,10.5665833,28.0686202,4.443207045,13.90794607,13.67424272,3.792085377,7.923036432,1.276078679,15.9949709,33.1829357,6.883400819,0.874142261,1.921251821,2.693448787,3.766831849,0.5,4.775746832,0.5,17.367682,0.5,13.72356663,16.91693754,1.504666244,0,2.610709155,4.629041422,0.5,0.5,9.790864264,28.10594733,11.36939271,0.5,0.5,1.453527741,1.703802591,31.90550177,16.30712148,4.004026687,14.90743022,0.500544618,10.87402765,0.311221698,2.147187739,1.502360902,5.187514819,9.925131085,10.76198474,0.786274883,0.5,0.924761104,7.318204372,1.219036023,3.556514095,14.93235377,11.36568869,0.893293504,0.928493263,1.693973073,2.904853313,11.57647602,1.266068647,4.260114189,5.586919895,30.46229149,13.87648118,11.74414356,6.976935052,0.624330759,3.251122348,0.5,15.69944659,24.67403199,8.829754886,1.814088842,1.984523463,11.62835811,2.218011424,13.04520265,8.249396953,2.386976634,4.332510061,1.507807916,2.35558598,2.765393563,7.676552742,16.06772796,0,0,15.87501649,1.324708555,15.6846865,3.660968763,10.95327863,16.80484059,3.564671453,7.793373065,0,27.78069396,12.20915815,0.5,1.54038294,2.001442085,39.44909607,5.632786824,13.59894726,8.098170516,5.509187173,7.442309152,3.187302356,4.589903763,0.749585006,0.5,4.741763407,5.144423498,0,2.269539356,2.057253396,3.568330976,25.53546801,0,26.81374707,0.5,5.9920316,44.95658459,9.975578776,12.66315401,0.5,13.589025,0.5,0,1.417736771),
  Breast_upper_CI = c(45.10083469,41.36194954,0.5,54.37340471,37.75727603,28.09229233,13.35801809,21.23098766,45.98591414,41.16956344,12.88630667,25.31511698,77.56477278,0,35.31986289,18.77362259,33.57020571,24.31450756,25.68652775,58.28314998,0,21.56013598,69.16542355,0.5,23.52364959,47.51244598,35.76278871,25,57.49142384,14.35299133,52.34796209,35.562029,46.84238439,27.30910333,13.53228138,23.66871347,43.8542234,31.82165845,32.99166261,31.42923649,25.34393826,0.5,25.52888101,45.61867942,20.84134845,55.33254517,19.18717382,31.74150575,58.68115428,37.72045827,22.61210538,67.29558385,36.19467983,0.5,0.5,25.78805354,0,0.5,63.62001691,0.5,0.5,45.22016895,59.32848173,32.31986189,37.05886062,32.13336486,50.61783322,0.5,27.86858222,29.79697324,26.56381938,61.76185571,34.57607275,46.8466341,16.96305802,48.60694683,71.14033129,36.28721229,0,31.31315704,66.72511686,30.10829969,29.52127916,0.5,45.16657431,66.82743829,46.57532678,60.99264487,30.15251735,51.10888577,28.34472296,0,0.5,57.68646661,14.98698382,48.94186994,28.50794404,44.91435509,67.82060972,73.00828203,39.2066296,46.39640372,48.82389682,34.41929839,24.78109367,44.00354379,0.5,36.82359507,29.58234951,33.21724302,23.65933518,23.6244016,0.5,45.38655142,0.5,55.97358397,39.32425031,54.24532409,30.45391151,43.34481753,25.81887741,0.5,37.3529052,0.5,33.02171003,51.06047554,30.74128032,0.5,25.59742996,28.87878954,0,0.5,0.5,19.32348414,22.56994291,52.8087414,15.32768381,15.43786521,0.5,33.65586116,24.80488268,60.00409654,46.75990869,60.46902118,55.83501683,67.20632975,19.92300073,59.29569907,0.5,22.67376472,57.89921062,28.83323901,36.7206089,36.82620319,0.5,17.94712743,0.5,0.5,0,19.17251907,44.36433404,0.5,14.2705018,31.94067139,51.3212538,48.8597795,21.31015908,27.38288237,60,0.5,13.42095202,29.25668152,43.66299224,65.60881704,22.87536257,41.08347804,30.23051092,19.7082728,23.75868519,21.3103971,48.65524337,46.44351433,23.67011425,17.60836336,32.29102247,26.50488459,34.76629227,0.5,34.9796989,0.5,52.42053264,0.5,39.34277567,57.1259831,33.46489031,0,74.82433117,67.37241316,0.5,0.5,36.11568719,58.71823961,39.35465359,0.5,0.5,18.43872926,27.26379125,51.23344787,49.3112948,20.90936631,28.489864,11.14810169,38.67858657,7.451991975,24.96779099,18.86130687,20.6219572,36.13668948,57.388471,13.95253161,0.5,58.70380059,42.23929923,17.05679782,25.77821885,45.85688681,25.43279972,16.49331082,58.60526654,15.93792797,15.07845251,38.06332796,20.19908629,22.70375157,32.4999042,60.11101725,26.60993256,29.60264725,36.49965807,13.41084009,41.31089157,0.5,48.16907742,42.66394606,23.70543887,26.48626141,25.15121243,48.74277092,39.45757834,43.6324757,23.22859777,14.65891615,31.63793957,24.21779604,21.44994732,34.18344961,52.30571059,36.47652013,0,0,24.22909544,25.18631276,48.50687813,44.07985483,20.57967835,45.56587629,37.70947191,23.14438231,0,48.43497234,37.13220332,0.5,23.0356707,28.18831163,51.13274979,55.42625777,33.63711539,58.13891497,0.5,50.28897933,41.66224667,68.68046165,20.74783428,13.99289722,0.5,46.79926673,25.25918154,0,29.50721707,28.14030108,29.23878723,47.5135787,0,43.79556077,0.5,42.89035855,67.67833126,16.66152539,27.36097387,0.5,72.60793911,0.5,0,29.76114409),
  
  Cervical_screening_Rate = c(25.43959278, 28.97216375, 13.90209609, 17.5883671, 34.92169698, 31.61619566, 0.5, 0.5, 19.79132729, 17.09823474, 49.289106, 34.77642776, 0, 26.32758657, 3.339096267, 5.220532969, 14.74004445, 28.49367796, 42.15309641, 0.5, 16.36067332, 9.594773612, 27.97895731, 19.60326076, 30.71291035, 38.10669666, 32.86375242, 15.21909881, 25.05031886, 15.8587295, 18.68974637, 29.87357919, 0.5, 25, 0, 11.9591133, 0.5, 32.18448162, 0, 0, 0, 0, 9.250429116, 12.69688513, 16.03586227, 0.5, 11.24762122, 6.65369407, 3.350998521, 8.426197166, 10.6419703, 35.26808553, 31.43393336, 24.45243748, 30.02623591, 29.78988948, 42.53825112, 5.482834129, 34.14247416, 0.5, 30.79229089, 15.74256262, 47.20168027, 25.96281737, 0.5, 9.069398732, 40.29057169, 60.1513037, 37.52741593, 7.386955328, 25.8011445, 35.25226238, 24.92342477, 38.00698059, 19.49270914, 13.7287314, 28.94212005, 30.40378875, 35.01494476, 12.5294583, 0.5, 18.12315571, 45.71823935, 35.5921025, 24.6104454, 56.82102182, 53.96323277, 52.02589703, 31.08153897, 69.67236988, 49.96327633, 32.76430206, 20.2346706, 23.7610599, 33.45436321, 12.96805604, 20.12573559, 56.24635579, 0.5, 50.81705477, 13.55020787, 0, 37.0613972, 40.91696749, 22.53609326, 39.07416135, 23.29105589, 9.27914417, 9.222240734, 0, 21.04329816, 31.76066078, 0.5, 33.33282961, 36.1300984, 12.47514667, 6.90908855, 24.06369816, 48.58798602, 27.59800556, 40.17665954, 33.08659838, 14.13562146, 24.8824333, 31.6563279, 40.14683911, 12.51545765, 0.5, 15.4931068, 8.044852173, 6.366752102, 25.28801402, 29.2804401, 21.24062257, 16.89216889, 7.19250507, 15.75234872, 40, 14.91907739, 0.5, 22.39180379, 0.5, 0.5, 35.30339186, 17.98832213, 26.58434576, 0.5, 0.5, 12.67300891, 20, 36.00094146, 40.34227421, 12.89896184, 35.35330101, 17.07956061, 23.11184717, 16.08530056, 22.97491639, 8.737274727, 31.3282622, 37.75562937, 4.680221423, 60.29104336, 14.04417922, 12.50747391, 8.584004554, 0.5, 2.062876317, 0, 0.5, 44.12210099, 29.58558638, 13.33392418, 24.87410924, 0.5, 16.2038561, 15.87968186, 17.94189344, 17.81492933, 23.21170839, 64.55032896, 52.55373314, 4.543631575, 0.5, 32.31503271, 24.927449, 25.20575856, 0, 10.88207931, 15.85559737, 20.05605356, 32.87994988, 26.46711718, 10.05313016, 0.5, 6.869659887, 0, 44.28186813, 22.8675136, 38.58102556, 9.487789447, 38.01456727, 66.66666667, 33.9701822, 0.5, 16.62785104, 0, 3.136840443, 0.5, 8.685251699, 44.4951794, 38.19409137, 40.35325209, 45.49086952, 24.1328341, 23.65396844, 4.695866769, 10.69319864, 5.579171256, 7.219688275, 6.18801919, 42.85233829, 24.39113525, 33.08120418, 4.470330695, 43.51415261, 22.27943184, 30.90817254, 17.63244277, 32.08538927, 20.75657951, 44.84499989, 16.34629092, 37.79581264, 61.19691357, 37.06100517, 41.55060315, 10.30927475, 0.5, 5.387839887, 19.90247676, 35.85187685, 30.79062979, 48.9468313, 19.44286127, 0, 37.08963345, 21.6453142, 54.18860689, 33.63494363, 31.44326094, 3.286252306, 19.54402138, 11.55769711, 8.646874156, 11.48725122, 26.47115115, 17.89004397, 28.06730574, 62.36241029, 13.79373736, 20.896119, 25.01790451, 41.4540879, 0, 37.10291303, 32.20532801, 32.30737293, 0.5, 14.86784086, 0.5, 14.77135454, 55.19645063, 19.75761921, 24.21288055, 44.85989465, 0.5, 15.10620988, 17.17626357, 19.74996822, 28.22909218, 0.5, 4.068596977, 20.77029803, 20.83646782, 18.38621095, 26.45289763, 3.676071406, 2.724912764, 12.14514155, 9.891772339, 20.73491579, 10.37582741, 23.68226257, 8.029030871, 0.5, 0.5, 0.5, 28.96126651, 21.79994041, 4.840015711, 30.32354814, 17.6182739, 9.43797311),
  
  Cervical_lower_CI = c(7.18290756, 16.18857871, 8.782399919, 10.02747231, 27.09132548, 12.6300423, 0.5, 0.5, 6.138523662, 5.638421756, 41.0899697, 18.48030669, 0, 13.66020449, 1.205131541, 1.279491242, 4.110475164, 18.35438877, 27.66817256, 0.5, 11.00969851, 2.424357021, 14.91232091, 15.78199237, 17.03854472, 24.60886675, 15.14152012, 5.309764561, 17.23445734, 8.254560815, 7.912878445, 14.99548187, 0.5, 25, 0, 3.352138452, 0.5, 22.89901308, 0, 0, 0, 0, 3.261577183, 4.362050378, 5.547203769, 0.5, 5.637419857, 2.352764123, 1.102677267, 2.204994343, 3.315988983, 20.94089721, 16.64605093, 14.95855546, 19.67102466, 23.67586356, 21.58904822, 1.261347067, 22.75961757, 0.5, 11.60838339, 10.72189579, 42.43545538, 8.08169922, 0.5, 4.11654199, 29.66281881, 45.63011754, 20.70715156, 3.574348721, 18.61592714, 16.32532771, 17.96684195, 19.91742609, 3.721208164, 4.065268268, 15.32068144, 12.07352336, 19.67862232, 5.316294721, 0.5, 14.6234821, 14.5324228, 15.55653731, 17.73884223, 36.13451302, 40.59340946, 27.88494752, 15.87215228, 54.72749138, 37.37390501, 25.64199152, 11.99876132, 13.62036924, 19.21764131, 3.062438945, 10.16767344, 26.01120443, 0.5, 27.59612199, 7.131949481, 0, 14.51701023, 20.49663365, 10.02314542, 30.5361538, 18.34191152, 2.644943864, 3.215406249, 0, 9.400542975, 20.29825405, 0.5, 24.71751724, 15.54719761, 4.385632647, 1.973474786, 14.88276383, 36.59098758, 21.07361583, 23.75138425, 17.14428466, 7.001639867, 14.12187212, 18.37089619, 27.79056549, 5.751001726, 0.5, 4.917013263, 2.282326182, 1.481871844, 19.98004756, 19.09256901, 12.10175466, 8.938545317, 1.93790357, 4.012463847, 40, 6.71460435, 0.5, 10.77279238, 0.5, 0.5, 29.48767111, 6.499854911, 16.43016325, 0.5, 0.5, 7.689372449, 20, 24.516799, 28.10757488, 5.279121175, 22.8231126, 2.037298226, 10.86366958, 9.441178142, 7.75027982, 4.387685936, 6.494450717, 24.40476704, 1.166513981, 31.88410919, 9.100270739, 6.993310556, 3.226727185, 0.5, 0.474184924, 0, 0.5, 29.08493055, 21.15610294, 6.351447205, 16.39215354, 0.5, 4.879911666, 2.971495658, 9.010687483, 6.169294277, 11.46720606, 40.33437718, 27.69507039, 1.440936223, 0.5, 23.15881218, 16.96121688, 12.0476434, 0, 3.336585164, 3.659031009, 10.35257035, 19.6891258, 15.67743211, 3.763002194, 0.5, 2.519458886, 0, 24.95656474, 15.04915768, 23.83950517, 3.360315189, 17.82500398, 66.66666667, 17.3615427, 0.5, 6.916613082, 0, 0.927199212, 0.5, 2.367730552, 33.91338987, 20.37852393, 27.29892096, 29.91006958, 12.14629172, 14.66825845, 1.116265969, 5.389795226, 1.786689146, 2.081726079, 1.592686885, 30.77476981, 14.69331021, 24.80360418, 1.044188767, 27.80944732, 12.29253908, 18.34531073, 9.726088887, 16.53420529, 11.04880241, 29.9196807, 7.723983943, 23.6953915, 37.41652477, 24.23430801, 26.21845474, 2.034111941, 0.5, 1.500018772, 9.596783805, 27.55560881, 14.84003416, 30.6932845, 8.388112181, 0, 23.09540979, 11.93213388, 18.65605166, 11.61541403, 20.45582103, 0.756677781, 9.30743214, 5.726773436, 2.176528012, 3.436826486, 12.09139708, 6.824333658, 17.03265722, 46.02990096, 8.884685793, 11.22680853, 13.60829975, 30.70768486, 0, 12.89263499, 17.46381444, 12.191444, 0.5, 7.953775331, 0.5, 7.013584022, 22.94564599, 10.63125889, 16.05596558, 25.06952378, 0.5, 6.16445926, 8.337304712, 14.78792514, 18.79828016, 0.5, 0.966224713, 13.28502978, 2.789659202, 3.610687201, 3.385541596, 0.799617028, 0.306613258, 7.488200613, 2.90010235, 7.844751801, 2.847766551, 14.11278914, 4.339255288, 0.5, 0.5, 0.5, 21.49634025, 8.179238958, 1.54853874, 17.70111645, 6.768562643, 3.195763062),
  # Cervical_lower_CI = c(64.5842, 71.417, 63.4997, 81.5149, 70.6684, 66.9369, 4.1396, 5.9942, 69.7342, 70.6215, 77.2031, 79.3823, 55.5165, 76.3087, 69.1085, 57.9289, 65.7017, 72.8505, 71.7545, 64.6995, 61.9382, 42.1668, 64.1437, 62.8046, 65.0095, 72.5218, 55.0314, 53.4014, 75.5115, 61.2726, 80.1339, 4.3268, 73.5819, 73.3885, 11.996, 5.1691, 75.1263, 82.7245, 74.751, 78.4249, 78.5651, 66.5786, 63.8033, 53.2142, 4.2377, 48.9753, 29.7734, 55.0208, 6.9943, 49.1929, 79.0951, 68.0467, 70.8698, 78.863, 69.36, 65.2974, 67.6673, 84.729, 4.203, 53.12, 64.0412, 63.7793, 79.0557, 3.8182, 38.0578, 78.3739, 72.328, 73.5954, 69.5097, 77.1412, 71.9678, 59.9145, 66.0449, 82.6379, 46.6369, 78.4032, 73.8161, 43.0409, 60.7067, 33.0613, 64.9391, 82.2788, 72.0038, 77.6742, 69.1633, 77.7289, 70.1682, 75.2173, 60.6837, 73.5913, 81.9002, 80.556, 76.8691, 80.7391, 25.0514, 8.7459, 60.7736, 80.4079, 82.7827, 86.6114, 76.8028, 76.2761, 75.1086, 81.8396, 31.7505, 33.6482, 72.7444, 64.2623, 74.2765, 48.2437, 82.605, 76.0, 78.0779, 67.6777, 84.6796, 83.3658, 71.0724, 72.7252, 76.3942, 83.0971, 78.0921, 79.8039, 65.3943, 45.2982, 68.0001, 54.1204, 68.2695, 66.0502, 68.596, 81.4854, 61.8574, 59.2743, 60.81, 57.0195, 66.7966, 4.2429, 64.318, 3.9328, 4.111, 70.5478, 45.4322, 68.1104, 16.6808, 5.0701, 70.8479, 52.6859, 68.3415, 51.5089, 73.0289, 7.925, 58.1874, 67.794, 75.7368, 46.5787, 63.222, 83.1345, 13.8964, 73.0367, 75.9462, 65.0482, 34.3128, 6.8973, 4.4781, 4.0502, 4.2236, 79.6678, 87.4368, 65.5999, 79.0323, 74.681, 81.2436, 78.5093, 64.8687, 77.0555, 74.1248, 84.3499, 78.5209, 58.1844, 71.2417, 74.5156, 82.927, 77.0439, 70.7271, 83.5334, 28.9828, 77.6873, 66.2517, 78.9607, 73.2684, 25.8581, 64.801, 63.0307, 81.0057, 66.545, 46.1396, 58.6185, 76.3189, 62.4022, 84.259, 80.7095, 81.0118, 68.7933, 53.465, 63.3071, 72.8069, 79.9776, 78.3543, 82.0373, 56.8762, 61.7168, 53.8779, 73.6033, 70.9339, 46.4103, 63.5091, 82.1245, 80.5978, 63.3154, 7.9077, 72.6514, 70.4938, 77.129, 75.3045, 66.7962, 76.0681, 74.697, 84.2538, 79.8392, 82.3859, 72.6211, 6.265, 4.3611, 18.6784, 48.6096, 76.2104, 77.0323, 50.3178, 73.0578, 69.6837, 41.155, 73.8534, 82.6302, 51.5305, 64.007, 33.2291, 45.4447, 24.0024, 32.9982, 69.6111, 73.9847, 48.3728, 64.809, 35.0912, 66.1133, 68.5493, 65.1965, 65.7074, 73.2627, 67.0359, 48.644, 67.6752, 6.0514, 77.7489, 73.8741, 52.3131, 76.1028, 57.8905, 72.0741, 65.2867, 27.3009, 38.764, 64.4288, 75.9063, 67.5493, 37.4351, 63.6402, 81.8392, 17.7911, 5.3603, 9.5012, 5.0488, 4.2119, 62.5582, 74.4682, 70.0556, 75.4377, 84.5522, 7.9637, 7.0684, 3.3297, 4.306, 66.6365, 75.814, 25.131, 71.4883, 77.0384, 76.0928),
  Cervical_upper_CI = c(60.06851588, 46.27667006, 21.30910974, 29.01198703, 43.66001698, 59.65571464, 0.5, 0.5, 48.21226563, 41.58501716, 57.52666157, 55.63537127, 0, 44.66492577, 8.910917813, 18.96822103, 41.08104913, 41.39432096, 58.1272163, 0.5, 23.6220066, 31.19313398, 46.26902798, 24.08516182, 48.89385564, 53.73152253, 57.31798174, 36.49426893, 34.91540571, 28.30662962, 38.07536325, 50.70758062, 0.5, 25, 0, 34.72521255, 0.5, 43.12897254, 0, 0, 0, 0, 23.55798196, 31.68185234, 38.31219244, 0.5, 21.18735294, 17.41469019, 9.732436186, 27.30007746, 29.25567408, 52.84541947, 51.27730819, 37.32709537, 42.92004556, 36.72312143, 66.55988554, 20.84947903, 47.70240811, 0.5, 60.1172709, 22.52116394, 52.01947222, 58.3095537, 0.5, 18.81217154, 51.91559412, 73.08204646, 58.01420915, 14.64850818, 34.58124129, 60.30717103, 33.47441099, 60.17972634, 60.26658265, 37.40635254, 47.8332128, 58.15647777, 54.2332961, 26.76313113, 0.5, 22.24217273, 80.66476834, 62.37219487, 33.07370877, 75.37355941, 66.78605753, 75.25644148, 51.87790156, 81.36377816, 62.55730571, 40.77995475, 32.06392955, 38.11988016, 51.51249864, 41.27237588, 35.9352132, 82.45840376, 0.5, 73.69071341, 24.23701605, 0, 67.1246628, 65.03870118, 43.17456751, 48.33819141, 29.09972479, 27.80166484, 23.70252186, 0, 40.63791525, 45.96308277, 0.5, 43.22678273, 63.48008499, 30.69580195, 21.48330094, 36.48082381, 60.74993405, 35.24044271, 59.1492589, 54.16269128, 26.46954725, 40.02123507, 48.80513623, 53.89640999, 25.11611375, 0.5, 39.39288592, 24.68190932, 23.51137645, 31.45185989, 42.07736047, 34.56684058, 29.62090621, 23.30834236, 45.54361791, 40, 29.93184388, 0.5, 40.8107641, 0.5, 0.5, 41.58959237, 40.900151, 40.00959063, 0.5, 0.5, 20.18051387, 20, 49.34766216, 53.90911324, 28.23835187, 50.2808906, 67.10557718, 42.57359315, 26.05963973, 51.43246037, 16.64791595, 74.97798544, 53.26404434, 16.9613753, 83.12225191, 21.05193074, 21.37048072, 20.91366412, 0.5, 8.518676571, 0, 0.5, 60.32071999, 39.6832687, 25.87192741, 35.86240975, 0.5, 42.15868915, 53.78086779, 32.55793635, 41.67897255, 41.36470149, 83.06462606, 76.20795282, 13.41768003, 0.5, 43.06259582, 35.05568379, 45.32839947, 0, 30.16613557, 48.31742713, 35.27576142, 49.46499571, 41.06613966, 24.21233286, 0.5, 17.39105158, 0, 65.50855739, 33.16207438, 55.76382201, 24.01233201, 63.42258257, 66.66666667, 55.74874159, 0.5, 34.86676231, 0, 10.07676028, 0.5, 27.1683936, 55.60085089, 59.87275371, 54.93324219, 62.00759891, 42.25846109, 35.832773, 17.69972507, 20.10601493, 16.10190381, 22.16788408, 21.18746348, 55.84598272, 37.66370408, 42.5578289, 17.18580322, 60.63811329, 36.96083008, 47.11056323, 29.84131988, 52.97908637, 35.5819273, 60.76047356, 31.32614456, 54.31436343, 80.62121246, 52.01578449, 58.7137986, 38.88647195, 0.5, 17.55627936, 36.7734155, 45.09124556, 53.17948424, 67.48561729, 38.88311795, 0, 53.648125, 36.03049283, 85.91673708, 66.15377066, 44.99410283, 13.15157173, 36.50714605, 21.9436608, 28.7074404, 32.12204846, 48.51440751, 39.32579583, 42.58175097, 76.29746665, 20.79610925, 35.55762461, 41.40849926, 53.08038201, 0, 70.15890959, 51.609504, 62.12979363, 0.5, 26.08868112, 0.5, 28.48171178, 83.59785089, 33.75899296, 34.7960232, 66.4238796, 0.5, 32.5228344, 32.10398719, 25.87149452, 40.05722716, 0.5, 15.56640201, 30.9669297, 70.70989131, 57.53474254, 78.68587763, 15.30366457, 20.32756875, 19.1002991, 28.74866972, 44.56339061, 31.37709156, 36.94901865, 14.38452588, 0.5, 0.5, 0.5, 37.77123788, 46.59311147, 14.12397234, 46.82562929, 38.64977813, 24.75498767)
  # Cervical_upper_CI = c(96.455, 89.6744, 84.6093, 95.7007, 96.2893, 87.5857, 41.8296, 50.6934, 90.7546, 92.1623, 94.4833, 96.8807, 94.8946, 93.8924, 86.1029, 82.5201, 85.2336, 91.099, 89.3442, 85.9795, 86.9258, 62.4239, 96.3759, 88.5744, 87.6114, 97.526, 74.7739, 82.4342, 92.2496, 84.8348, 97.5999, 42.4255, 95.8188, 97.7257, 56.2568, 47.9552, 97.8595, 97.4857, 97.8408, 96.2176, 96.3147, 85.1232, 96.3206, 86.4919, 41.7787, 66.3463, 52.5208, 75.5387, 22.2745, 66.4027, 95.644, 93.425, 91.8081, 96.7798, 97.2285, 96.5456, 88.0379, 97.8009, 41.7226, 83.5918, 93.1666, 89.9362, 96.9853, 30.2032, 84.7153, 95.2609, 97.5163, 97.662, 83.7848, 96.5067, 95.992, 92.5137, 90.812, 95.5583, 67.7746, 95.0523, 92.3663, 74.2962, 91.3715, 57.802, 91.4449, 96.0033, 90.8567, 95.6245, 97.0999, 96.441, 97.238, 97.8714, 87.5234, 94.0166, 93.6937, 94.3296, 96.2409, 97.7978, 77.23, 47.497, 95.8098, 95.9952, 96.788, 97.9983, 98.034, 95.2612, 94.1662, 96.7566, 57.8853, 62.3465, 90.6888, 91.1505, 89.2389, 69.687, 94.8879, 97.9533, 96.221, 91.5237, 96.0178, 95.0212, 97.358, 92.7702, 97.9843, 97.5275, 96.4835, 96.7201, 85.9647, 70.907, 91.8501, 76.8006, 88.2153, 90.8135, 90.1383, 95.0212, 83.2475, 87.097, 89.251, 81.2711, 86.1411, 41.637, 84.0554, 41.0986, 40.976, 97.2856, 67.6494, 81.1701, 39.9177, 46.0315, 85.4417, 86.7461, 96.9985, 88.2576, 95.9556, 37.9542, 88.6345, 87.8989, 93.4887, 70.2023, 85.8969, 97.339, 39.76, 97.7789, 92.01, 89.3276, 61.6098, 28.5187, 42.9285, 41.5516, 41.6231, 96.6541, 97.9168, 90.346, 94.7758, 93.6834, 93.7698, 95.9459, 85.9038, 95.8826, 97.7392, 96.2289, 96.8578, 82.3062, 93.664, 97.7712, 97.3805, 91.4529, 97.3112, 97.6372, 54.7909, 96.5711, 96.7451, 96.298, 92.1598, 53.6804, 96.4953, 93.1092, 96.2296, 92.8431, 80.3403, 83.2676, 93.8842, 96.1151, 96.6333, 94.9303, 97.1739, 89.6549, 81.0314, 85.259, 89.8992, 97.6712, 95.9, 97.0094, 83.82, 78.402, 83.4463, 88.3593, 89.8884, 76.036, 87.549, 97.2425, 94.9044, 85.1907, 31.3346, 97.5486, 88.9178, 90.2917, 94.432, 96.7688, 95.9255, 92.6084, 95.5317, 95.0831, 97.2171, 89.6965, 33.5629, 42.2643, 36.7317, 77.6359, 95.4091, 92.9412, 85.4453, 97.6044, 91.4488, 91.1903, 97.7002, 97.5503, 71.4725, 84.3035, 58.0553, 61.2997, 45.5081, 60.6508, 92.5747, 95.3971, 76.582, 91.6799, 65.7148, 88.7169, 86.4327, 96.5466, 96.6215, 90.2568, 95.1589, 83.4567, 96.8973, 50.4759, 96.427, 95.4681, 73.9518, 98.4896, 86.7524, 95.865, 91.9676, 68.235, 90.3808, 94.2766, 97.9441, 93.3056, 67.7681, 82.5417, 97.0127, 39.547, 47.3596, 46.4134, 28.826, 27.7752, 90.0415, 94.2016, 93.9006, 92.8916, 96.2174, 24.0476, 33.7062, 20.6823, 41.9916, 88.6241, 97.914, 43.8422, 97.4141, 98.0642, 96.2826)
)



# subcounty_screening_data <- data.frame(
#   Subcounty = subcounty_names,
#   Breast_screening_Rate = c(),
#   Breast_lower_CI = c(),
#   Breast_upper_CI = c(),
#   Cervical_screening_Rate = c(),
#   Cervical_lower_CI = c(),
#   Cervical_upper_CI = c()
# )

sub_county_shapefile <- left_join(sub_county_shapefile, subcounty_screening_data, by = c("subcounty" = "Subcounty"))

# 2022 provinces
screening_data_2022_province <- data.frame(
  Province = c(
    "Central Province", "Coast Province", "Eastern Province", "Nairobi Province",
    "North Eastern Province", "Nyanza Province", "Rift Valley Province", "Western Province"
  ),
  Screening_Rate = c(35.86, 15.43, 24.11, 42.66, 7.12, 29.60, 30.03, 22.79),
  CI_Lower = c(31.79, 12.46, 20.30, 34.65, -1.31, 26.54, 26.26, 17.86),
  CI_Upper = c(39.94, 18.41, 27.92, 50.66, 15.56, 32.67, 33.79, 27.71),
  Standard_Error = c(2.08, 1.52, 1.94, 4.08, 4.30, 1.56, 1.92, 2.51)
)


ui <- page_navbar(
  id = "navbar",
  title = "Screening rates for Cervical and Breast Cancers in Kenya",
  nav_spacer(),
  
  # Landing Page
  nav_panel("Landing Page", value = "landing_page",
            div(
              style = "position: relative; height: 100%; overflow: hidden;",
              leafletOutput("kenya_map", height = "100%"),
              # fluidRow(
              #   column(12,
              #          absolutePanel(id = "controls", class = "panel panel-default",
              #                        bottom = 20, right = 20, width = 300, fixed = TRUE,
              #                        draggable = TRUE, height = "auto",
              #                        tags$div(
              #                          style = "background-image: url('https://www.example.com/user_image.jpg'); 
              #                                   background-size: cover; 
              #                                   background-position: center; 
              #                                   color: white; 
              #                                   border: 2px solid grey; 
              #                                   padding: 10px; 
              #                                   border-radius: 5px; height: 120px; margin-bottom: 10px;",
              #                          valueBox(
              #                            value = "44,726", 
              #                            subtitle = "Total Cancer Cases", 
              #                            icon = icon("cancer", lib = "font-awesome"),
              #                            width = 12
              #                          )
              #                        ),
              #                        tags$div(
              #                          style = "background-image: url('https://www.example.com/user_image.jpg'); 
              #                                   background-size: cover; 
              #                                   background-position: center; 
              #                                   color: white; 
              #                                   border: 2px solid grey; 
              #                                   padding: 10px; 
              #                                   border-radius: 5px; height: 120px; margin-bottom: 10px;",
              #                          valueBox(
              #                            value = "7,243", 
              #                            subtitle = "Breast Cancer Cases", 
              #                            icon = icon("female", lib = "font-awesome"),
              #                            width = 12
              #                          )
              #                        ),
              #                        tags$div(
              #                          style = "background-image: url('https://www.example.com/user_image.jpg'); 
              #                                   background-size: cover; 
              #                                   background-position: center; 
              #                                   color: white; 
              #                                   border: 2px solid grey; 
              #                                   padding: 10px; 
              #                                   border-radius: 5px; height: 120px;",
              #                          valueBox(
              #                            value = "5,845", 
              #                            subtitle = "Cervical Cancer Cases", 
              #                            icon = icon("female", lib = "font-awesome"),
              #                            width = 12
              #                          )
              #                        )
              #          )
              #   )
              # )
            )
  ),
  
  # Screening Rates
  
  
  # New Panel for Provinces
  nav_panel("Provinces", value = "provinces_page",
            # Horizontal row for input boxes (Select Years, Select Cancer Type, Select Age Range)
            fluidRow(
              # column(4,
              #        box(title = "Select Cancer Type", status = "primary", width = 12, solidHeader = TRUE,
              #            style = "height: 50px !important; display: flex; flex-wrap: wrap; gap: 10px;",
              #            splitLayout(
              #              cellWidths = c("50%", "50%"), 
              #              radioButtons("year_select_prov", label = NULL,
              #                           choices = list("2014" = "2014", "2022" = "2022"),
              #                           selected = "2014", inline = TRUE)
              #            )
              #        )
              # ),
              column(4, 
                     box(title = "Select Cancer Type", status = "primary", width = 12, solidHeader = TRUE,
                         style = "height: 50px !important; display: flex; flex-wrap: wrap; gap: 10px;",
                         splitLayout(
                           cellWidths = c("50%", "50%"), 
                           radioButtons("cancer_type_prov_prov", label = NULL,
                                        choices = list("Cervical Cancer" = "cervical", "Breast Cancer" = "breast"),
                                        selected = "cervical", inline = TRUE)
                         )
                     )
              )
              # ,
              # column(4, 
              #        box(title = "Select Age Range", status = "primary", width = 12, solidHeader = TRUE,
              #            style = "height: 50px !important",
              #            splitLayout(
              #              cellWidths = c("50%", "50%"), 
              #              radioButtons("age_range_prov", label = NULL, 
              #                           choices = list("30-34" = "30-34", "35-39" = "35-39", 
              #                                          "40-44" = "40-44", "45-49" = "45-49"),
              #                           selected = "30-34", inline = TRUE)
              #            )
              #        )
              # )
            ),
            
            # The map and caterpillar plot layout (as before)
            fluidRow(
              # Left Section: Province Map (8 Columns)
              column(8,
                     h3("Provinces in Kenya"),
                     leafletOutput("provinces_map", height = "600px")
              ),
              
              # Right Section: Caterpillar Plot (4 Columns)
              column(4,
                     h3("Screening Rates by Province"),
                     plotOutput("caterpillar_plot_province", height = "600px")
              )
            )
  ),
  
  
  # New Panel for Counties
  nav_panel("Counties", value = "counties_page",
            fluidRow(
              # column(4,
              #        box(title = "Select Cancer Type", status = "primary", width = 12, solidHeader = TRUE,
              #            style = "height: 50px !important; display: flex; flex-wrap: wrap; gap: 10px;",
              #            splitLayout(
              #              cellWidths = c("50%", "50%"), 
              #              radioButtons("year_select_prov", label = NULL,
              #                           choices = list("2014" = "2014", "2022" = "2022"),
              #                           selected = "2014", inline = TRUE)
              #            )
              #        )
              # ),
              column(4, 
                     box(title = "Select Cancer Type", status = "primary", width = 12, solidHeader = TRUE,
                         style = "height: 50px !important; display: flex; flex-wrap: wrap; gap: 10px;",
                         splitLayout(
                           cellWidths = c("50%", "50%"), 
                           radioButtons("cancer_type_prov_county", label = NULL,
                                        choices = list("Cervical Cancer" = "cervical", "Breast Cancer" = "breast"),
                                        selected = "cervical", inline = TRUE)
                         )
                     )
              )
              # ,
              # column(4, 
              #        box(title = "Select Age Range", status = "primary", width = 12, solidHeader = TRUE,
              #            style = "height: 50px !important",
              #            splitLayout(
              #              cellWidths = c("50%", "50%"), 
              #              radioButtons("age_range", label = NULL, 
              #                           choices = list("30-34" = "30-34", "35-39" = "35-39", 
              #                                          "40-44" = "40-44", "45-49" = "45-49"),
              #                           selected = "30-34", inline = TRUE)
              #            )
              #        )
              # )
            ),
            
            fluidRow(
              # Left Section: County Map (8 Columns)
              column(8,
                     h3("Counties in Kenya"),
                     leafletOutput("counties_map", height = "600px")
              ),
              
              # Right Section: County Details (4 Columns)
              column(4,
                     h3("Screening Rates by County"),
                     plotOutput("caterpillar_plot", height = "600px")
              )
            )
  ),
  
  # New Panel for Sub-Counties
  nav_panel("Sub-Counties", value = "sub_counties_page",
            fluidRow(
              # column(4,
              #        box(title = "Select Cancer Type", status = "primary", width = 12, solidHeader = TRUE,
              #            style = "height: 50px !important; display: flex; flex-wrap: wrap; gap: 10px;",
              #            splitLayout(
              #              cellWidths = c("50%", "50%"), 
              #              radioButtons("year_select_prov", label = NULL,
              #                           choices = list("2014" = "2014", "2022" = "2022"),
              #                           selected = "2014", inline = TRUE)
              #            )
              #        )
              # ),
              column(4, 
                     box(title = "Select Cancer Type", status = "primary", width = 12, solidHeader = TRUE,
                         style = "height: 50px !important; display: flex; flex-wrap: wrap; gap: 10px;",
                         splitLayout(
                           cellWidths = c("50%", "50%"), 
                           radioButtons("cancer_type_prov_county", label = NULL,
                                        choices = list("Cervical Cancer" = "cervical", "Breast Cancer" = "breast"),
                                        selected = "cervical", inline = TRUE)
                         )
                     )
              )
              # ,
              # column(4, 
              #        box(title = "Select Age Range", status = "primary", width = 12, solidHeader = TRUE,
              #            style = "height: 50px !important",
              #            splitLayout(
              #              cellWidths = c("50%", "50%"), 
              #              radioButtons("age_range", label = NULL, 
              #                           choices = list("30-34" = "30-34", "35-39" = "35-39", 
              #                                          "40-44" = "40-44", "45-49" = "45-49"),
              #                           selected = "30-34", inline = TRUE)
              #            )
              #        )
              # )
            ),
            
            fluidRow(
              # Left Section: County Map (8 Columns)
              column(8,
                     h3("Sub-Counties in Kenya"),
                     leafletOutput("sub_counties_map", height = "600px")
              )
            ),
            fluidRow(
              # Right Section: County Details (4 Columns)
              column(12,
                     h3("Screening Rates by Sub-County"),
                     #plotOutput("caterpillar_plot_subcounty", height = "600px")
                     plotlyOutput("caterpillar_plot_subcounty", width = "100%", height = "3500px")
                     
              )
            )
  ),
  
  # County Dashboard
  #nav_panel("County Dashboard", value = "county_dashboard",
  #           fluidRow(
  #             column(12,
  #                    h3(textOutput("county_dashboard_title")),
  #                    uiOutput("county_dashboard_content"),
  #                    actionButton("back_to_screening_rates", "Back to Screening Rates", class = "btn-secondary")
  #             )
  #           )
  # ),
  
  # About This Site
  # nav_panel("About This Site", value = "about_page"),
  
  # Dark Mode Toggle
  nav_item(input_dark_mode(id = "dark_mode", mode = "light"))
)

# server <- function(input, output, session) {
#   
#   output$kenya_map <- renderLeaflet({
#     map_provider <- if (input$dark_mode == "dark") {
#       providers$CartoDB.DarkMatter
#     } else {
#       providers$CartoDB.Positron
#     }
#     
#     kenya_data <- ne_countries(scale = "medium", returnclass = "sf") %>%
#       subset(name == "Kenya")
#     
#     leaflet(kenya_data) %>%
#       addProviderTiles(map_provider) %>%
#       addPolygons(
#         weight = 1,
#         color = "black", 
#         fillColor = "#2a7f62",  
#         fillOpacity = 0.4
#       ) %>%
#       setView(lng = 37.90, lat = -0.0236, zoom = 6)
#   })
#   
#   selected_county <- reactiveValues(name = NULL, data = NULL)
#   
#   screening_rates <- data.frame(
#     county = rep(kenya_shapefile$ADM1_EN, each = 20),
#     age = rep(30:49, times = nrow(kenya_shapefile)),
#     cervical_2014 = sample(10:60, nrow(kenya_shapefile)*20, replace = TRUE),
#     cervical_2022 = sample(20:70, nrow(kenya_shapefile)*20, replace = TRUE),
#     breast_2014 = sample(5:50, nrow(kenya_shapefile)*20, replace = TRUE),
#     breast_2022 = sample(15:65, nrow(kenya_shapefile)*20, replace = TRUE)
#   )
#   output$counties_map <- renderLeaflet({
#     map_provider <- if (input$dark_mode == "dark") {
#       providers$CartoDB.DarkMatter
#     } else {
#       providers$CartoDB.Positron
#     }
#     
#     leaflet(kenya_shapefile) %>% 
#       addProviderTiles(map_provider) %>% 
#       addPolygons(
#         fillOpacity = 0.5,  
#         color = "black",    
#         weight = 1,
#         layerId = ~ADM1_EN,  
#         popup = ~paste0("<b>County:</b> ", ADM1_EN)  
#       ) %>% 
#       setView(lng = 37.90, lat = -0.0236, zoom = 6)  
#   })
#   
#   output$shapefile_map <- renderLeaflet({
#     map_provider <- if (input$dark_mode == "dark") {
#       providers$CartoDB.DarkMatter
#     } else {
#       providers$CartoDB.Positron
#     }
#     
#     leaflet(kenya_shapefile) %>% 
#       addProviderTiles(map_provider) %>% 
#       addPolygons(
#         fillOpacity = 0.5,  
#         color = "black",    
#         weight = 1,
#         layerId = ~ADM1_EN,  
#         popup = ~paste0("<b>County:</b> ", ADM1_EN)  
#       ) %>% 
#       setView(lng = 37.90, lat = -0.0236, zoom = 6)  
#   })
#   
#   selected_province <- reactiveVal(NULL)
#   
#   # Render Province Map
#   output$provinces_map <- renderLeaflet({
#     map_provider <- if (input$dark_mode == "dark") {
#       providers$CartoDB.DarkMatter
#     } else {
#       providers$CartoDB.Positron
#     }
#     
#     province_shapefile <- left_join(province_shapefile, province_screening_data, by = c("Province_Name" = "Province")) 
#     leaflet(province_shapefile) %>% 
#       addProviderTiles(map_provider) %>%
#       addPolygons(
#         fillOpacity = 0.5,  
#         color = "black",    
#         weight = 1,
#         fillColor = ifelse(input$dark_mode == "dark", "#2a7f62"
#                            , "#2a7f62"),
#         layerId = ~Province_Name,  # Province Name as layer ID
#         label = ~paste0(Province_Name, "  : " , Screening_Rate, "%"),  # Show name on hover
#         labelOptions = labelOptions(
#           direction = "auto",
#           style = list(
#             "font-weight" = "normal",
#             "padding" = "4px",
#             "font-size" = "13px",
#             "background-color" = "white",
#             "border-radius" = "6px",
#             "color" = "black"
#           ),
#           opacity = 0.9,
#           textsize = "13px"
#         ),
#         highlightOptions = highlightOptions(
#           color = "red", weight = 2, bringToFront = TRUE
#         )
#       ) %>%
#       setView(lng = 37.90, lat = -0.0236, zoom = 6)  
#   })
#   
#   # Observe Click on Province Map
#   observeEvent(input$provinces_map_shape_click, {
#     clicked_province <- input$provinces_map_shape_click$id  # Get clicked province name
#     selected_province(clicked_province)  # Store the selection
#   })
#   
#   # Render Caterpillar Plot with Highlighting
#   output$caterpillar_plot <- renderPlot({
#     # Ensure selected_province() is not NULL
#     selected_prov <- selected_province()
#     
#     # Create a new column to highlight the selected province
#     province_screening_data$highlight <- if (is.null(selected_prov)) {
#       # If no province is selected, set all provinces to blue
#       TRUE
#     } else {
#       # If a province is selected, highlight it in red, and others in grey
#       province_screening_data$Province == selected_prov
#     }
#     
#     ggplot(province_screening_data, aes(x = reorder(Province, Screening_Rate), y = Screening_Rate)) +
#       geom_point(aes(color = highlight), size = 4) +  
#       geom_errorbar(aes(ymin = lower_CI, ymax = upper_CI), width = 0.2, color = "black") +  
#       coord_flip() +  
#       theme_minimal() +
#       scale_color_manual(values = c("FALSE" = "grey", "TRUE" = "red")) +  # Set default as blue, selected as red
#       labs(
#         title = "Cancer Screening Rates by Province",
#         x = "Province",
#         y = "Screening Rate (%)"
#       ) +
#       theme(
#         axis.text.y = element_text(size = 12, face = "bold"),
#         axis.text.x = element_text(size = 12),
#         legend.position = "none"
#       )
#   })
#   
#   observeEvent(input$provinces_map_shape_click, {
#     clicked_province <- input$provinces_map_shape_click$id  # Get clicked province name
#     selected_province(clicked_province)  # Store the selection
#     
#     # After selecting a province, navigate to the Counties Panel
#     updateNavbarPage(session, inputId = "navbar", selected = "counties_page")
#   })
#   
#   
#   # Existing functionality for dark mode toggle
#   observeEvent(input$dark_mode, {
#     if (input$dark_mode == "dark") {
#       showNotification("Welcome to the dark side!")
#     }
#   })
#   
#   # Navigation between different sections
#   observeEvent(input$go_to_dashboard, {
#     updateNavbarPage(session, inputId = "navbar", selected = "county_dashboard")
#   })
#   
#   observeEvent(input$back_to_screening_rates, {
#     updateNavbarPage(session, inputId = "navbar", selected = "screening_page")
#   })
# }

server <- function(input, output, session) {
  
  output$kenya_map <- renderLeaflet({
    map_provider <- if (input$dark_mode == "dark") {
      providers$CartoDB.DarkMatter
    } else {
      providers$CartoDB.Positron
    }
    
    kenya_data <- ne_countries(scale = "medium", returnclass = "sf") %>%
      subset(name == "Kenya")
    
    leaflet(kenya_data) %>%
      addProviderTiles(map_provider) %>%
      addPolygons(
        weight = 1,
        color = "black", 
        fillColor = "#2a7f62",  
        fillOpacity = 0.4
      ) %>%
      setView(lng = 37.90, lat = -0.0236, zoom = 6)
  })
  
  selected_county <- reactiveValues(name = NULL, data = NULL)
  
  screening_rates <- data.frame(
    county = rep(kenya_shapefile$ADM1_EN, each = 20),
    age = rep(30:49, times = nrow(kenya_shapefile)),
    cervical_2014 = sample(10:60, nrow(kenya_shapefile)*20, replace = TRUE),
    cervical_2022 = sample(20:70, nrow(kenya_shapefile)*20, replace = TRUE),
    breast_2014 = sample(5:50, nrow(kenya_shapefile)*20, replace = TRUE),
    breast_2022 = sample(15:65, nrow(kenya_shapefile)*20, replace = TRUE)
  )
  
  filtered_county_data <- reactive({
    cancer_type <- input$cancer_type_prov_county
    
    kenya_shapefile %>%
      mutate(
        Screening_Rate = if (cancer_type == "breast") Breast_screening_Rate else Cervical_screening_Rate,
        lower_CI = if (cancer_type == "breast") Breast_lower_CI else Cervical_lower_CI,
        upper_CI = if (cancer_type == "breast") Breast_upper_CI else Cervical_upper_CI
      )
  })
  
  output$counties_map <- renderLeaflet({
    map_provider <- if (input$dark_mode == "dark") {
      providers$CartoDB.DarkMatter
    } else {
      providers$CartoDB.Positron
    }
    
    leaflet(kenya_shapefile) %>% 
      addProviderTiles(map_provider) %>% 
      addPolygons(
        fillOpacity = 0.5,  
        fillColor = "#2a7f62",  
        color = "black",    
        weight = 1,
        layerId = ~ADM1_EN,  
        label = ~lapply({
          if (input$cancer_type_prov_county == "breast") {
            paste0(
              "<strong>", ADM1_EN, "</strong><br/>",
              "Breast Screening Rate: ", round(Breast_screening_Rate, 1), "%<br/>",
              "CI: ", round(Breast_lower_CI, 1), "% - ", round(Breast_upper_CI, 1), "%"
            )
          } else {
            paste0(
              "<strong>", ADM1_EN, "</strong><br/>",
              "Cervical Screening Rate: ", round(Cervical_screening_Rate, 1), "%<br/>",
              "CI: ", round(Cervical_lower_CI, 1), "% - ", round(Cervical_upper_CI, 1), "%"
            )
          }
        }, htmltools::HTML) %>% lapply(htmltools::HTML),
        highlightOptions = highlightOptions(
          color = "red", weight = 2, bringToFront = TRUE
        ),
        labelOptions = labelOptions(
          direction = "auto",
          style = list(
            "font-weight" = "normal",
            "padding" = "4px",
            "font-size" = "13px",
            "background-color" = "white",
            "border-radius" = "6px",
            "color" = "black"
          ),
          opacity = 0.9,
          textsize = "13px"
        )
      ) %>%
      
      setView(lng = 37.90, lat = -0.0236, zoom = 6)  
  })
  
  # output$caterpillar_plot <- renderPlot({
  #   data <- filtered_county_data()
  #   
  #   ggplot(data, aes(x = reorder(ADM1_EN, Screening_Rate), y = Screening_Rate)) +
  #     geom_point(color = "red", size = 3) +
  #     geom_errorbar(aes(ymin = lower_CI, ymax = upper_CI), width = 0.2, color = "black") +
  #     coord_flip() +
  #     theme_minimal() +
  #     labs(
  #       title = "Cancer Screening Rates by County",
  #       x = "County",
  #       y = "Screening Rate (%)"
  #     ) +
  #     theme(
  #       axis.text.y = element_text(size = 10),
  #       axis.text.x = element_text(size = 10)
  #     )
  # })
  
  # library(plotly)
  # 
  # output$caterpillar_plot <- renderPlotly({
  #   plot_data <- filtered_county_data()
  #   
  #   p <- ggplot(plot_data, aes(x = reorder(ADM1_EN, Screening_Rate), y = Screening_Rate)) +
  #     geom_point(color = "red", size = 1.5) +
  #     geom_errorbar(aes(ymin = lower_CI, ymax = upper_CI),size = 0.4, width = 0.2, color = "black") +
  #     coord_flip() + theme_minimal() +
  #     labs(x = "County", y = "Screening Rate (%)")
  #   
  #   ggplotly(p, , tooltip = "text")
  # })
  
  output$caterpillar_plot <- renderPlot({
    data <- filtered_county_data() %>%
      filter(!is.na(Screening_Rate), !is.na(lower_CI), !is.na(upper_CI))
    
    ggplot(data, aes(x = reorder(ADM1_EN, Screening_Rate), y = Screening_Rate)) +
      geom_point(color = "red", size = 2) +  # smaller dots
      geom_errorbar(aes(ymin = lower_CI, ymax = upper_CI), 
                    width = 0.2, color = "black", size = 0.4) +  # thinner black lines
      coord_flip() +
      theme_minimal() +
      labs(
        title = "Cancer Screening Rates by County",
        x = "County",
        y = "Screening Rate (%)"
      ) +
      theme(
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)
      )
  })
  
  output$shapefile_map <- renderLeaflet({
    map_provider <- if (input$dark_mode == "dark") {
      providers$CartoDB.DarkMatter
    } else {
      providers$CartoDB.Positron
    }
    
    leaflet(kenya_shapefile) %>% 
      addProviderTiles(map_provider) %>% 
      addPolygons(
        fillOpacity = 0.5,  
        color = "black",  
        fillColor = ifelse(input$dark_mode == "dark", "#2a7f62", "#2a7f62"),
        weight = 1,
        layerId = ~ADM1_EN,  
        popup = ~paste0("<b>County:</b> ", ADM1_EN)  
      ) %>% 
      setView(lng = 37.90, lat = -0.0236, zoom = 6)  
  })
  
  selected_province <- reactiveVal(NULL)
  
  # ✅ Reactive: Filter screening data based on selected cancer type(s)
  selected_screening_data <- reactive({
    year <- input$year_select_prov
    cancer_type <- input$cancer_type_prov_prov
    data <- NULL
    
    if (year == "2022") {
      # Use the 2022 province data
      data <- screening_data_2022_province
      # Add placeholders for CI naming consistency
      data$lower_CI <- data$CI_Lower
      data$upper_CI <- data$CI_Upper
      # Rename to match 2014 structure
      colnames(data)[colnames(data) == "Province"] <- "Province"
      
    } else if (year == "2014") {
      # Start from base 2014 data
      data <- province_screening_data
      if (cancer_type == "breast") {
        data$Screening_Rate <- data$Province_Breast_screening_Rate
        data$lower_CI <- data$Province_Breast_lower_CI
        data$upper_CI <- data$Province_Breast_upper_CI
      } else if (cancer_type == "cervical") {
        data$Screening_Rate <- data$Province_Cervical_screening_Rate
        data$lower_CI <- data$Province_Cervical_lower_CI
        data$upper_CI <- data$Province_Cervical_upper_CI
      }
    }
    
    data
  })
  
  
  # ✅ Render Province Map with selected cancer screening data
  # output$provinces_map <- renderLeaflet({
  #   map_provider <- if (input$dark_mode == "dark") {
  #     providers$CartoDB.DarkMatter
  #   } else {
  #     providers$CartoDB.Positron
  #   }
  #   
  #   map_data <- left_join(province_shapefile, selected_screening_data(), by = c("Province_Name" = "Province")) 
  #   
  #   leaflet(map_data) %>% 
  #     addProviderTiles(map_provider) %>%
  #     addPolygons(
  #       fillOpacity = 0.5,  
  #       color = "black",    
  #       weight = 1,
  #       fillColor = ifelse(input$dark_mode == "dark", "#2a7f62", "#2a7f62"),
  #       layerId = ~Province_Name,
  #       label = ~lapply({
  #         if (input$cancer_type_prov_prov == "breast") {
  #           paste0(
  #             "<strong>", Province_Name, "</strong><br/>",
  #             "Breast Screening Rate: ", round(Province_Breast_screening_Rate, 1), "%<br/>",
  #             "CI: ", round(Province_Breast_lower_CI, 1), "% - ", round(Province_Breast_upper_CI, 1), "%"
  #           )
  #         } else {
  #           paste0(
  #             "<strong>", Province_Name, "</strong><br/>",
  #             "Cervical Screening Rate: ", round(Province_Cervical_screening_Rate, 1), "%<br/>",
  #             "CI: ", round(Province_Cervical_lower_CI, 1), "% - ", round(Province_Cervical_upper_CI, 1), "%"
  #           )
  #         }
  #       }, htmltools::HTML),
  #       labelOptions = labelOptions(
  #         direction = "auto",
  #         style = list(
  #           "font-weight" = "normal",
  #           "padding" = "4px",
  #           "font-size" = "13px",
  #           "background-color" = "white",
  #           "border-radius" = "6px",
  #           "color" = "black"
  #         ),
  #         opacity = 0.9,
  #         textsize = "13px"
  #       ),
  #       highlightOptions = highlightOptions(
  #         color = "red", weight = 2, bringToFront = TRUE
  #       )
  #     ) %>%
  #     setView(lng = 37.90, lat = -0.0236, zoom = 6)  
  # })
  
  #########final
  output$provinces_map <- renderLeaflet({
    map_provider <- if (input$dark_mode == "dark") {
      providers$CartoDB.DarkMatter
    } else {
      providers$CartoDB.Positron
    }
    
    map_data <- left_join(province_shapefile, selected_screening_data(), by = c("Province_Name" = "Province"))
    
    pal <- colorNumeric(palette = "YlOrRd", domain = map_data$Screening_Rate)
    
    leaflet(map_data) %>% 
      addProviderTiles(map_provider) %>%
      addPolygons(
        fillColor = ~pal(Screening_Rate),
        fillOpacity = 0.7,
        color = "black",
        weight = 1,
        layerId = ~Province_Name,
        label = ~lapply({
          if (input$cancer_type_prov_prov == "breast") {
            paste0(
              "<strong>", Province_Name, "</strong><br/>",
              "Breast Screening Rate: ", round(Province_Breast_screening_Rate, 1), "%<br/>",
              "CI: ", round(Province_Breast_lower_CI, 1), "% - ", round(Province_Breast_upper_CI, 1), "%"
            )
          } else {
            paste0(
              "<strong>", Province_Name, "</strong><br/>",
              "Cervical Screening Rate: ", round(Province_Cervical_screening_Rate, 1), "%<br/>",
              "CI: ", round(Province_Cervical_lower_CI, 1), "% - ", round(Province_Cervical_upper_CI, 1), "%"
            )
          }
        }, htmltools::HTML),
        labelOptions = labelOptions(
          direction = "auto",
          style = list(
            "font-weight" = "normal",
            "padding" = "4px",
            "font-size" = "13px",
            "background-color" = "white",
            "border-radius" = "6px",
            "color" = "black"
          ),
          opacity = 0.9,
          textsize = "13px"
        ),
        highlightOptions = highlightOptions(
          color = "red", weight = 2, bringToFront = TRUE
        )
      ) %>%
      addLegend(
        "bottomright", pal = pal, values = ~Screening_Rate,
        title = "Screening Rate (%)",
        opacity = 0.7
      ) %>%
      setView(lng = 37.90, lat = -0.0236, zoom = 6)
  })
  
  
  
  
  
  observeEvent(input$provinces_map_shape_click, {
    clicked_province <- input$provinces_map_shape_click$id
    selected_province(clicked_province)
    # updateNavbarPage(session, inputId = "navbar", selected = "counties_page")
  })
  
  # ✅ Caterpillar Plot dynamically based on selection
  output$caterpillar_plot_province <- renderPlot({
    selected_prov <- selected_province()
    
    plot_data <- selected_screening_data()
    plot_data$highlight <- if (is.null(selected_prov)) {
      TRUE
    } else {
      plot_data$Province == selected_prov
    }
    
    ggplot(plot_data, aes(x = reorder(Province, Screening_Rate), y = Screening_Rate)) +
      geom_point(aes(color = highlight), size = 4) +  
      geom_errorbar(aes(ymin = lower_CI, ymax = upper_CI), width = 0.2, color = "black") +  
      coord_flip() +  
      theme_minimal() +
      scale_color_manual(values = c("FALSE" = "grey", "TRUE" = "red")) +
      labs(
        title = "Cancer Screening Rates by Province",
        x = "Province",
        y = "Screening Rate (%)"
      ) +
      theme(
        axis.text.y = element_text(size = 12, face = "bold"),
        axis.text.x = element_text(size = 12),
        legend.position = "none"
      )
  })
  # output$sub_counties_map <- renderLeaflet({
  #   map_provider <- if (input$dark_mode == "dark") {
  #     providers$CartoDB.DarkMatter
  #   } else {
  #     providers$CartoDB.Positron
  #   }
  #   
  #   sub_data <- sub_county_shapefile %>%
  #     mutate(
  #       Screening_Rate = if (input$cancer_type_prov_county == "breast") Breast_screening_Rate else Cervical_screening_Rate
  #     )
  #   
  #   leaflet(sub_data) %>%
  #     addProviderTiles(map_provider) %>%
  #     addCircleMarkers(
  #       radius = 5,
  #       fillColor = "#2a7f62",
  #       fillOpacity = 0.8,
  #       color = "black",
  #       stroke = TRUE,
  #       weight = 1,
  #       layerId = ~ADM2_EN,
  #       label = ~lapply(
  #         if (input$cancer_type_prov_county == "breast") {
  #           paste0("<strong>", ADM2_EN, "</strong><br/>",
  #                  "Breast Screening Rate: ", round(Breast_screening_Rate, 1), "%")
  #         } else {
  #           paste0("<strong>", ADM2_EN, "</strong><br/>",
  #                  "Cervical Screening Rate: ", round(Cervical_screening_Rate, 1), "%")
  #         },
  #         htmltools::HTML
  #       ),
  #       labelOptions = labelOptions(
  #         direction = "auto",
  #         style = list(
  #           "font-weight" = "normal",
  #           "padding" = "4px",
  #           "font-size" = "13px",
  #           "background-color" = "white",
  #           "border-radius" = "6px",
  #           "color" = "black"
  #         ),
  #         opacity = 0.9,
  #         textsize = "13px"
  #       )
  #     ) %>%
  #     setView(lng = 37.90, lat = -0.0236, zoom = 6)
  # })
  
  # output$sub_counties_map <- renderLeaflet({
  #   map_provider <- if (input$dark_mode == "dark") {
  #     providers$CartoDB.DarkMatter
  #   } else {
  #     providers$CartoDB.Positron
  #   }
  # 
  #   sub_data <- sub_county_shapefile %>%
  #     mutate(
  #       Screening_Rate = if (input$cancer_type_prov_county == "breast") Breast_screening_Rate else Cervical_screening_Rate
  #     )
  # 
  #   leaflet(sub_data) %>%
  #     addProviderTiles(map_provider) %>%
  #     addPolygons(
  #       fillOpacity = 0.5,
  #       color = "black",
  #       fillColor = ifelse(input$dark_mode == "dark", "#2a7f62", "#2a7f62"),
  #       weight = 1,
  #       layerId = ~subcounty,
  #       label = ~lapply({
  #         if (input$cancer_type_prov_county == "breast") {
  #           paste0("<strong>", subcounty, "</strong><br/>",
  #                  "Breast Screening Rate: ", round(Breast_screening_Rate, 1), "%<br/>",
  #                  "CI: ", round(Breast_lower_CI, 1), "% - ", round(Breast_upper_CI, 1), "%")
  #         } else {
  #           paste0("<strong>", subcounty, "</strong><br/>",
  #                  "Cervical Screening Rate: ", round(Cervical_screening_Rate, 1), "%<br/>",
  #                  "CI: ", round(Cervical_lower_CI, 1), "% - ", round(Cervical_upper_CI, 1), "%")
  #         }
  #       }, htmltools::HTML)
  #       ,
  #       labelOptions = labelOptions(
  #         direction = "auto",
  #         style = list(
  #           "font-weight" = "normal",
  #           "padding" = "4px",
  #           "font-size" = "13px",
  #           "background-color" = "white",
  #           "border-radius" = "6px",
  #           "color" = "black"
  #         ),
  #         opacity = 0.9,
  #         textsize = "13px"
  #       ),
  #       highlightOptions = highlightOptions(
  #         color = "red", weight = 2, bringToFront = TRUE
  #       )
  #     ) %>%
  #     setView(lng = 37.90, lat = -0.0236, zoom = 6)
  # })
  
  
  ########################final  county
  output$counties_map <- renderLeaflet({
    map_provider <- if (input$dark_mode == "dark") {
      providers$CartoDB.DarkMatter
    } else {
      providers$CartoDB.Positron
    }
    
    county_data <- kenya_shapefile %>%
      mutate(
        Screening_Rate = if (input$cancer_type_prov_county == "breast") Breast_screening_Rate else Cervical_screening_Rate
      )
    
    pal <- colorNumeric("YlOrRd", domain = county_data$Screening_Rate)
    
    leaflet(county_data) %>%
      addProviderTiles(map_provider) %>%
      addPolygons(
        fillColor = ~pal(Screening_Rate),
        fillOpacity = 0.7,
        color = "black",
        weight = 1,
        layerId = ~ADM1_EN,
        label = ~lapply({
          if (input$cancer_type_prov_county == "breast") {
            paste0("<strong>", ADM1_EN, "</strong><br/>",
                   "Breast Screening Rate: ", round(Breast_screening_Rate, 1), "%<br/>",
                   "CI: ", round(Breast_lower_CI, 1), "% - ", round(Breast_upper_CI, 1), "%")
          } else {
            paste0("<strong>", ADM1_EN, "</strong><br/>",
                   "Cervical Screening Rate: ", round(Cervical_screening_Rate, 1), "%<br/>",
                   "CI: ", round(Cervical_lower_CI, 1), "% - ", round(Cervical_upper_CI, 1), "%")
          }
        }, htmltools::HTML),
        labelOptions = labelOptions(
          direction = "auto",
          style = list(
            "font-weight" = "normal",
            "padding" = "4px",
            "font-size" = "13px",
            "background-color" = "white",
            "border-radius" = "6px",
            "color" = "black"
          ),
          opacity = 0.9,
          textsize = "13px"
        ),
        highlightOptions = highlightOptions(
          color = "red", weight = 2, bringToFront = TRUE
        )
      ) %>%
      addLegend("bottomright", pal = pal, values = ~Screening_Rate,
                title = "Screening Rate (%)", opacity = 0.7) %>%
      setView(lng = 37.90, lat = -0.0236, zoom = 6)
  })
  
  output$sub_counties_map <- renderLeaflet({
    map_provider <- if (input$dark_mode == "dark") {
      providers$CartoDB.DarkMatter
    } else {
      providers$CartoDB.Positron
    }
    
    sub_data <- sub_county_shapefile %>%
      mutate(
        Screening_Rate = if (input$cancer_type_prov_county == "breast") Breast_screening_Rate else Cervical_screening_Rate
      )
    
    # pal <- colorNumeric("YlOrRd", domain = sub_data$Screening_Rate)
    # Define color palette excluding NAs
    pal <- colorNumeric("YlOrRd", domain = sub_data$Screening_Rate, na.color = "#A9A9A9")  # grey for NA
    
    
    leaflet(sub_data) %>%
      addProviderTiles(map_provider) %>%
      addPolygons(
        fillColor = ~pal(Screening_Rate),
        fillOpacity = 0.7,
        color = "black",
        weight = 1,
        layerId = ~subcounty,
        label = ~lapply({
          if (input$cancer_type_prov_county == "breast") {
            paste0("<strong>", subcounty, "</strong><br/>",
                   "Breast Screening Rate: ", round(Breast_screening_Rate, 1), "%<br/>",
                   "CI: ", round(Breast_lower_CI, 1), "% - ", round(Breast_upper_CI, 1), "%")
          } else {
            paste0("<strong>", subcounty, "</strong><br/>",
                   "Cervical Screening Rate: ", round(Cervical_screening_Rate, 1), "%<br/>",
                   "CI: ", round(Cervical_lower_CI, 1), "% - ", round(Cervical_upper_CI, 1), "%")
          }
        }, htmltools::HTML),
        labelOptions = labelOptions(
          direction = "auto",
          style = list(
            "font-weight" = "normal",
            "padding" = "4px",
            "font-size" = "13px",
            "background-color" = "white",
            "border-radius" = "6px",
            "color" = "black"
          ),
          opacity = 0.9,
          textsize = "13px"
        ),
        highlightOptions = highlightOptions(
          color = "red", weight = 2, bringToFront = TRUE
        )
      ) %>%
      addLegend("bottomright", pal = pal, values = ~Screening_Rate[!is.na(Screening_Rate)],
                title = "Screening Rate (%)", opacity = 0.7) %>%
      setView(lng = 37.90, lat = -0.0236, zoom = 6)
  })
  
  filtered_subcounty_data <- reactive({
    cancer_type <- input$cancer_type_prov_county
    
    sub_county_shapefile %>%
      mutate(
        Screening_Rate = if (cancer_type == "breast") Breast_screening_Rate else Cervical_screening_Rate,
        lower_CI = if (cancer_type == "breast") Breast_lower_CI else Cervical_lower_CI,
        upper_CI = if (cancer_type == "breast") Breast_upper_CI else Cervical_upper_CI
      )
  })
  
  
  output$caterpillar_plot_subcounty <- renderPlot({
    data <- filtered_subcounty_data() %>%
      filter(!is.na(Screening_Rate), !is.na(lower_CI), !is.na(upper_CI))
    
    ggplot(data, aes(x = reorder(subcounty, Screening_Rate), y = Screening_Rate)) +
      geom_point(color = "red", size = 1.5) +
      geom_errorbar(aes(ymin = lower_CI, ymax = upper_CI), width = 0.2, color = "black", size = 0.3) +
      coord_flip() +
      theme_minimal() +
      labs(
        title = "Cancer Screening Rates by Sub-County",
        x = "Sub-County",
        y = "Screening Rate (%)"
      ) +
      theme(
        axis.text.y = element_text(size = 5, hjust = 1),
        axis.text.x = element_text(size = 10),
        plot.title = element_text(size = 14, face = "bold")
      )
  })
  
  
  # output$caterpillar_plot_subcounty <- renderPlotly({
  #   data <- filtered_subcounty_data() %>%
  #     filter(!is.na(Screening_Rate), !is.na(lower_CI), !is.na(upper_CI)) %>%
  #     arrange(Screening_Rate) %>%
  #     mutate(subcounty = factor(subcounty, levels = unique(subcounty)))
  #   
  #   p <- ggplot(data, aes(x = Screening_Rate, y = subcounty, text = paste0(
  #     "Sub-County: ", subcounty, "<br>",
  #     "Screening Rate: ", round(Screening_Rate, 1), "%<br>",
  #     "95% CI: ", round(lower_CI, 1), "–", round(upper_CI, 1), "%"
  #   ))) +
  #     geom_point(color = "red", size = 1.3) +
  #     geom_errorbarh(aes(xmin = lower_CI, xmax = upper_CI), width = 0.2, color = "black", size = 0.3) +
  #     labs(
  #       title = "Cancer Screening Rates by Sub-County",
  #       x = "Screening Rate (%)",
  #       y = "Sub-County"
  #     ) +
  #     theme_minimal()
  #   
  #   ggplotly(p, tooltip = "text")
  # })
  output$caterpillar_plot_subcounty <- renderPlotly({
    data <- filtered_subcounty_data() %>%
      filter(!is.na(Screening_Rate), !is.na(lower_CI), !is.na(upper_CI)) %>%
      mutate(
        subcounty_clean = stringr::str_remove(subcounty, " Sub County$"),
        subcounty_clean = factor(subcounty_clean, levels = subcounty_clean[order(Screening_Rate)])
      )
    
    p <- ggplot(data, aes(x = Screening_Rate, y = subcounty_clean, text = paste0(
      "Sub-County: ", subcounty_clean, "<br>",
      "Screening Rate: ", round(Screening_Rate, 1), "%<br>",
      "95% CI: ", round(lower_CI, 1), "–", round(upper_CI, 1), "%"
    ))) +
      geom_point(color = "red", size = 1.3) +  # bigger, bold red dot
      geom_errorbarh(
        aes(xmin = lower_CI, xmax = upper_CI),
        height = 0.2,             # slim endcaps
        color = "black",
        size = 0.3                # thicker error bar line
      ) +
      labs(
        title = "Cancer Screening Rates by Sub-County",
        x = "Screening Rate (%)",
        y = "Sub-County"
      ) +
      theme_minimal()
    
    
    ggplotly(p, tooltip = "text")
  })
  
  
  # Dark mode notification
  observeEvent(input$dark_mode, {
    if (input$dark_mode == "dark") {
      showNotification("Welcome to the dark side!")
    }
  })
  
  # Page navigation buttons
  observeEvent(input$go_to_dashboard, {
    updateNavbarPage(session, inputId = "navbar", selected = "county_dashboard")
  })
  
  observeEvent(input$back_to_screening_rates, {
    updateNavbarPage(session, inputId = "navbar", selected = "screening_page")
  })
}

shinyApp(ui, server)